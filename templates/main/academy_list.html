{% extends "templates/main/base.html" %}

{% block contents %}

{% load humanize %}

<div class="title_small"> {% include 'main/search.html' %} </div>

<a href="{% url 'map' %}">←지도에서보기</a><br>

<form action="{% url 'academy_list' %}" method="get" id="search_form">
    <div class="selectbox">
        <label for="시도명">시도명:</label>
        <select name="시도명" id="시도명">
            <option value="">-- 선택하세요 --</option>
            {% for region in 시도명_list %}
            <option value="{{ region }}" {% if region == 시도명_selected %}selected{% endif %}>{{ region }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="selectbox">
        <label for="시군구명">시군구명:</label>
        <select name="시군구명" id="시군구명" {% if not 시도명_selected %}disabled{% endif %}>
            <option value="">-- 먼저 시도명을 선택하세요 --</option>
            {% if 시군구명_selected %}
            <option value="{{ 시군구명_selected }}" selected>{{ 시군구명_selected }}</option>
            {% endif %}
        </select>
    </div>

    <div class="selectbox">
        <label for="행정동명">행정동명:</label>
        <select name="행정동명" id="행정동명" {% if not 시군구명_selected %}disabled{% endif %}>
            <option value="">-- 먼저 시군구명을 선택하세요 --</option>
            {% if 행정동명_selected %}
            <option value="{{ 행정동명_selected }}" selected>{{ 행정동명_selected }}</option>
            {% endif %}
        </select>
    </div>

    <div class="selectbox">
        <label for="과목">과목:</label>
        <select name="과목" id="과목">
            <option value="">전체</option>
            {% for subject in 과목_list %}
            <option value="{{ subject }}" {% if subject == 과목_selected %}selected{% endif %}>{{ subject }}</option>
            {% endfor %}
        </select>
    </div>

    <button type="submit">검색</button>
</form>

<br>

<h1>결과 리스트</h1>

<div>
    {% if academylist %}
        {% for academy in academylist %}
            <a href="{% url 'academy' academy.id %}">{{ academy.상호명 }}</a><br>
        {% endfor %}
    {% else %}
        <p>결과가 없습니다.</p>
    {% endif %}
</div>

<!-- 페이지 네비게이션 -->
<div class="pagination">
    {% if academylist.has_previous %}
        <a href="?page=1{% if 시도명_selected %}&시도명={{ 시도명_selected }}{% endif %}{% if 시군구명_selected %}&시군구명={{ 시군구명_selected }}{% endif %}{% if 행정동명_selected %}&행정동명={{ 행정동명_selected }}{% endif %}{% if 과목_selected %}&과목={{ 과목_selected }}{% endif %}">처음</a>
        <a href="?page={{ academylist.previous_page_number }}{% if 시도명_selected %}&시도명={{ 시도명_selected }}{% endif %}{% if 시군구명_selected %}&시군구명={{ 시군구명_selected }}{% endif %}{% if 행정동명_selected %}&행정동명={{ 행정동명_selected }}{% endif %}{% if 과목_selected %}&과목={{ 과목_selected }}{% endif %}">이전</a>
    {% endif %}

    <span>페이지 {{ academylist.number }} / {{ academylist.paginator.num_pages }}</span>

    {% if academylist.has_next %}
        <a href="?page={{ academylist.next_page_number }}{% if 시도명_selected %}&시도명={{ 시도명_selected }}{% endif %}{% if 시군구명_selected %}&시군구명={{ 시군구명_selected }}{% endif %}{% if 행정동명_selected %}&행정동명={{ 행정동명_selected }}{% endif %}{% if 과목_selected %}&과목={{ 과목_selected }}{% endif %}">다음</a>
        <a href="?page={{ academylist.paginator.num_pages }}{% if 시도명_selected %}&시도명={{ 시도명_selected }}{% endif %}{% if 시군구명_selected %}&시군구명={{ 시군구명_selected }}{% endif %}{% if 행정동명_selected %}&행정동명={{ 행정동명_selected }}{% endif %}{% if 과목_selected %}&과목={{ 과목_selected }}{% endif %}">마지막</a>
    {% endif %}
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $("#시도명").change(function () {
            let 시도명 = $(this).val();
            if (시도명) {
                $.ajax({
                    url: "{% url 'get_regions' %}",
                    data: { level: "시군구명", parent_value: 시도명 },
                    success: function (response) {
                        let options = '<option value="">-- 선택하세요 --</option>';
                        response.regions.forEach(function (region) {
                            options += `<option value="${region}">${region}</option>`;
                        });
                        $("#시군구명").html(options).prop("disabled", false);
                        $("#행정동명").html('<option value="">-- 먼저 시군구명을 선택하세요 --</option>').prop("disabled", true);
                    }
                });
            } else {
                $("#시군구명").html('<option value="">-- 먼저 시도명을 선택하세요 --</option>').prop("disabled", true);
                $("#행정동명").html('<option value="">-- 먼저 시군구명을 선택하세요 --</option>').prop("disabled", true);
            }
        });

        $("#시군구명").change(function () {
            let 시군구명 = $(this).val();
            if (시군구명) {
                $.ajax({
                    url: "{% url 'get_regions' %}",
                    data: { level: "행정동명", parent_value: 시군구명 },
                    success: function (response) {
                        let options = '<option value="">-- 선택하세요 --</option>';
                        response.regions.forEach(function (region) {
                            options += `<option value="${region}">${region}</option>`;
                        });
                        $("#행정동명").html(options).prop("disabled", false);
                    }
                });
            } else {
                $("#행정동명").html('<option value="">-- 먼저 시군구명을 선택하세요 --</option>').prop("disabled", true);
            }
        });
    });
</script>

<style>
    .selectbox label {
        display: block;
        margin-bottom: 0.5rem;
    }

    .selectbox select, button {
        width: 100%;
        padding: 0.5rem;
        font-size: 1rem;
    }

    button {
        margin-top: 1rem;
        padding: 0.75rem;
    }

    h1 {
        margin-top: 2rem;
        font-size: 1.5rem;
    }

    a {
        font-size: 1rem;
        text-decoration: none;
    }
</style>

{% endblock %}
