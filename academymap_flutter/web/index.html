<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="academymap_flutter">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>ğŸ« AcademyMap - í•™ì›ì§€ë„</title>
  <link rel="manifest" href="manifest.json">
  
  <!-- ë„¤ì´ë²„ ì§€ë„ API -->
  <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=qcf9quj1gi"></script>
</head>
<body>
  <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
  <div id="naverMap" style="width:100%;height:100%;"></div>
  
  <!-- ë„¤ì´ë²„ ì§€ë„ JavaScript í•¨ìˆ˜ -->
  <script>
    let map = null;
    let markers = [];

    // ë„¤ì´ë²„ ì§€ë„ ì´ˆê¸°í™”
    function initNaverMap() {
      if (typeof naver === 'undefined') {
        console.error('ë„¤ì´ë²„ ì§€ë„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
      }

      const mapOptions = {
        center: new naver.maps.LatLng(37.5665, 126.978), // ì„œìš¸ ì‹œì²­
        zoom: 11,
        mapTypeControl: false,
        zoomControl: true,
        logoControl: false
      };

      map = new naver.maps.Map('naverMap', mapOptions);
      console.log('ë„¤ì´ë²„ ì§€ë„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ë§ˆì»¤ ì—…ë°ì´íŠ¸
    function updateMapMarkers(academyData) {
      if (!map) {
        console.error('ì§€ë„ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
      }

      // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
      markers.forEach(marker => {
        marker.setMap(null);
      });
      markers = [];

      // ìƒˆ ë§ˆì»¤ ì¶”ê°€
      academyData.forEach(academy => {
        if (academy.lat && academy.lng) {
          const position = new naver.maps.LatLng(academy.lat, academy.lng);
          
          const marker = new naver.maps.Marker({
            position: position,
            map: map,
            title: academy.name,
            icon: {
              content: '<div style="background: #007bff; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">ğŸ«</div>',
              size: new naver.maps.Size(24, 24),
              anchor: new naver.maps.Point(12, 12)
            }
          });

          // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
          const infoWindow = new naver.maps.InfoWindow({
            content: '<div style="padding: 10px; min-width: 200px;">' +
                    '<h4 style="margin: 0 0 8px 0; color: #333;">' + academy.name + '</h4>' +
                    '<p style="margin: 0; color: #666; font-size: 12px;">' + academy.address + '</p>' +
                    (academy.subject ? '<p style="margin: 4px 0 0 0; color: #007bff; font-size: 11px;">ğŸ“š ' + academy.subject + '</p>' : '') +
                    '</div>'
          });

          naver.maps.Event.addListener(marker, 'click', function() {
            if (infoWindow.getMap()) {
              infoWindow.close();
            } else {
              infoWindow.open(map, marker);
            }
          });

          markers.push(marker);
        }
      });

      console.log(`ì§€ë„ì— ${markers.length}ê°œ ë§ˆì»¤ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);

      // ë§ˆì»¤ë“¤ì´ ëª¨ë‘ ë³´ì´ë„ë¡ ì§€ë„ ë²”ìœ„ ì¡°ì •
      if (markers.length > 0) {
        const bounds = new naver.maps.LatLngBounds();
        markers.forEach(marker => {
          bounds.extend(marker.getPosition());
        });
        map.fitBounds(bounds);
      }
    }

    // Flutterì˜ HtmlElementViewë¥¼ ìœ„í•œ ì„¤ì •
    window.addEventListener('flutter-initialized', function() {
      console.log('Flutter ì´ˆê¸°í™” ì™„ë£Œ');
    });
  </script>
  
  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
